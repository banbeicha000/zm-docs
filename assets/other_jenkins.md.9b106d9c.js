import{_ as s,o as n,c as a,X as l}from"./chunks/framework.a911dc49.js";const o="/zm-docs/assets/jenkins-jdk.7e109dee.webp",e="/zm-docs/assets/jenkins-variable.1bdde6ab.webp",p="/zm-docs/assets/jenkins-variable2.6311b001.webp",t="/zm-docs/assets/jenkins-version.9e1301c8.webp",c="/zm-docs/assets/jenkins-install.1dae4682.webp",i="/zm-docs/assets/jenkins-install2.9cd44032.webp",r="/zm-docs/assets/jenkins-install3.af83da5d.webp",C="/zm-docs/assets/jenkins-install4.d6810c80.webp",y="/zm-docs/assets/jenkins-install5.0784467a.webp",A="/zm-docs/assets/jenkins-install6.c6b3ffa9.webp",D="/zm-docs/assets/jenkins-config.33323028.webp",m="/zm-docs/assets/jenkins-config2.da1a1a13.webp",d="/zm-docs/assets/jenkins-config3.57a7e56f.webp",g="/zm-docs/assets/jenkins-config4.f3860fc5.webp",F="/zm-docs/assets/jenkins-config5.5ed99406.webp",h="/zm-docs/assets/jenkins-config6.7c0c2d5e.webp",q=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"other/jenkins.md","filePath":"other/jenkins.md","lastUpdated":1704262034000}'),_={name:"other/jenkins.md"},k=l('<h2 id="准备环境" tabindex="-1">准备环境 <a class="header-anchor" href="#准备环境" aria-label="Permalink to &quot;准备环境&quot;">​</a></h2><ol><li>jenkins官网地址 <a href="https://www.jenkins.io/zh/doc/book/installing/#prerequisites" target="_blank" rel="noreferrer">https://www.jenkins.io/zh/doc/book/installing/#prerequisites</a></li><li>Java或者JDK <a href="https://www.oracle.com/cn/java/technologies/downloads/#java17" target="_blank" rel="noreferrer">https://www.oracle.com/cn/java/technologies/downloads/#java17</a></li></ol><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>注意点：Jenkins安装的版本需要和Java对应，否则在安装Jenkins时会报这个提示</p></div><p><img src="'+o+'" alt="img.png"></p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><ol><li>安装JDK 下载Java成功后，根据个人习惯选择安装目录，路径非中文。根据提示安装完成后，配置系统环境变量，如下图:变量名起为JAVA_HOME 值为安装路径 <img src="'+e+'" alt="img.png"> 在系统变量中path 内新增一条，值为 %JAVA_HOME%\\bin <img src="'+p+'" alt="img.png"> 完成后在终端输入 java -version 如下图，完成 <img src="'+t+'" alt="img.png"></li><li>安装Jenkins 下载Jenkins，安装 <img src="'+c+'" alt="img.png"> 选择第一个，将Jenkins作为Windows系统服务，点击next进入下一步 <img src="'+i+'" alt="img.png"> 配置端口，填写一个端口，可以通过test port验证端口是否被其他程序占用，测试通过会打钩 一直下一步，如出现提示Java版本不对，在该文最前面的图，则按照提示下载对应版本，重新安装即可。<br> 安装完成，在浏览器输入localhost:9090，端口号为安装时配置。 <img src="'+r+'" alt="img.png"> 输入密码 复制路径，文本代开，复制密码，输入,下一步 <img src="'+C+'" alt="img.png"><img src="'+y+'" alt="img.png"> 选择推荐安装即可 <img src="'+A+'" alt="img.png"><strong>jenkins配置</strong></li><li>node全局配置 <img src="'+D+'" alt="img.png"> 2种，安装目录或者自动安装</li></ol><ul><li>本地安装目录 <img src="'+m+'" alt="img.png"> 配置后 <img src="'+d+'" alt="img.png"></li><li>自动安装 <img src="'+g+'" alt="img.png"></li></ul><ol start="2"><li>项目配置 <img src="'+F+`" alt="img.png"></li></ol><p>构建脚本</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">@echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">off</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">&quot;%status%&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollback</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">即将回滚到#%version%版本</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">exist</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">E:\\myspace\\Jenkins\\.jenkins\\jobs\\%JOB_NAME%\\builds\\%version%\\archive\\dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">rd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/q</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">E:\\myspace\\Jenkins\\.jenkins\\workspace\\%JOB_NAME%\\dist</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">正在复制文件</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">xcopy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/s</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">E:\\myspace\\Jenkins\\.jenkins\\jobs\\%JOB_NAME%\\builds\\%version%\\archive\\dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">E:\\myspace\\Jenkins\\.jenkins\\workspace\\%JOB_NAME%\\dist</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">正在回滚至#%version%版本</span></span>
<span class="line"><span style="color:#A6ACCD;">) else (</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">版本不存在或有误！</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)else (</span></span>
<span class="line"><span style="color:#FFCB6B;">call</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">打包完成</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exit</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span></code></pre></div><ol start="3"><li>上传文件到远程服务 <img src="`+h+`" alt="img.png"> 本地默认打包后的文件夹为 dist</li><li>本地nginx 安装nginx软件，</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">rmdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/q</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/s</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">D:\\nginx-1.24.0\\html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">xcopy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/s</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">E:\\myspace\\Jenkins\\.jenkins\\workspace\\%JOB_NAME%\\dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">D:\\nginx-1.24.0\\html</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">完成</span></span></code></pre></div><p><strong>补充</strong></p><ol><li>Jenkins 安装目录启动终端</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">jenkins.exe</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">jenkins.exe</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span></code></pre></div><ol start="2"><li>nginx 安装目录启动终端</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">reload</span></span></code></pre></div><ol start="3"><li>配置遇到的问题</li></ol><details><summary>jenkins执行远程服务器命令返回code127</summary><p>执行的上传文件路径有问题</p></details><details><summary>Windows batch command exit0</summary><p>脚本末尾添加 <code>exit 0</code> 退出，开头加上 <code>call</code></p></details><details><summary>Jenkins windows 执行批量cmd命令XCOPY 提示&#39;XCOPY&#39; 不是内部或外部命令，也不是可运行的程序 或批处理文件。</summary><p>在Jenkins system全局属性中添加environment variables下新增 Path，值增加为 C:\\Windows\\System32\\（一般xcopy程序在该路径下）</p></details><details><summary>Windows平台Jenkins 调用脚本shell出错</summary><p>windows环境不支持shell语句导致，解决措施，在Jenkins system全局属性中添加environment variables ,通过git bash执行shell脚本。 <br> 键：Path <br> 值：<code>git bash bin</code> <br> ---实际操作未解决 </p></details>`,22),u=[k];function b(E,w,j,v,f,B){return n(),a("div",null,u)}const x=s(_,[["render",b]]);export{q as __pageData,x as default};
